{"ast":null,"code":"var _jsxFileName = \"/home/javiera/Documents/UNIVERSIDAD/2020-2/Arquitectura de Software/G16/iic2173-proyecto-semestral-grupo-16v2-frontend/src/components/RoomsPanel/RoomsPanel.jsx\";\nimport React, { useState, useEffect } from 'react';\nimport { useHistory } from 'react-router-dom';\nimport { url_add_room, url_rooms, url_auth } from \"./../Routes\";\nimport { useAuth0 } from \"@auth0/auth0-react\";\nimport Rooms from '../Rooms/Rooms';\nimport './RoomsPanel.css';\n\nconst RoomsPanel = () => {\n  const history = useHistory();\n  const [rooms, setRooms] = useState([]);\n  const {\n    user,\n    isAuthenticated,\n    isLoading,\n    logout,\n    getAccessTokenSilently\n  } = useAuth0();\n  const [loaded, setLoaded] = useState(false);\n\n  const checkUserUndefined = () => {\n    if (window.localStorage.getItem('userId') == undefined) {\n      window.localStorage.removeItem('userId');\n    }\n  };\n\n  useEffect(() => {\n    checkUserUndefined();\n\n    if (isLoading) {} else if (!loaded) {\n      setLoaded(true);\n\n      const getUserMetadata = async () => {\n        const domain = \"dev-3qxptrmu.us.auth0.com\";\n\n        try {\n          const accessToken = await getAccessTokenSilently({\n            audience: `https://${domain}/api/v2/`,\n            scope: \"read:current_user\"\n          });\n          const userDetailsByIdUrl = `https://${domain}/api/v2/users/${user.sub}`;\n          const metadataResponse = await fetch(userDetailsByIdUrl, {\n            headers: {\n              Authorization: `Bearer ${accessToken}`\n            }\n          });\n          const {\n            user_metadata\n          } = await metadataResponse.json();\n          window.localStorage.setItem('userId', user_metadata.id);\n        } catch (e) {\n          console.log(\"ERROR:\", e.message);\n        }\n      };\n\n      var requestOptions = {\n        Accept: 'application/json',\n        method: 'GET'\n      };\n\n      const getRooms = async () => {\n        fetch(url_rooms, requestOptions).then(async response => {\n          try {\n            const data = await response.json().then(result => {\n              setRooms(result);\n            });\n          } catch (err) {\n            console.log(err);\n          }\n        });\n      };\n\n      getUserMetadata();\n      getRooms();\n    }\n  });\n\n  const handleExitPanel = () => {\n    history.push('/admin');\n  };\n\n  const handleEnterChat = event => {\n    event.preventDefault();\n    const data = event.target.value;\n    var sepData = data.split(\".\");\n    const chatId = sepData[0];\n    const chatName = sepData[1];\n    history.push(`/admin/chat?name=${chatName}&room=${chatId}`);\n    window.location.reload();\n  };\n\n  const handleLogOutClick = () => {\n    window.localStorage.removeItem('userId');\n    logout({\n      returnTo: url_auth\n    });\n  }; // If is admin: \n\n\n  return isAuthenticated && /*#__PURE__*/React.createElement(\"div\", {\n    key: isLoading,\n    class: \"Full\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 92,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    class: \"Console\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 93,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: 'Bar',\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 94,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: 'Left',\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 95,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 96,\n      columnNumber: 21\n    }\n  }, /*#__PURE__*/React.createElement(\"button\", {\n    type: \"submit\",\n    onClick: handleExitPanel,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 96,\n      columnNumber: 26\n    }\n  }, \"Back to Admin Panel\"))), /*#__PURE__*/React.createElement(\"div\", {\n    className: 'Right',\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 98,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(\"h3\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 99,\n      columnNumber: 21\n    }\n  }, \" \", /*#__PURE__*/React.createElement(\"button\", {\n    type: \"submit\",\n    onClick: handleLogOutClick,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 99,\n      columnNumber: 26\n    }\n  }, \" Log Out\")))), /*#__PURE__*/React.createElement(\"br\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 102,\n      columnNumber: 17\n    }\n  }), /*#__PURE__*/React.createElement(\"br\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 104,\n      columnNumber: 17\n    }\n  }), /*#__PURE__*/React.createElement(\"br\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 104,\n      columnNumber: 26\n    }\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    class: \"container\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 105,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    class: \"box\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 106,\n      columnNumber: 21\n    }\n  }, /*#__PURE__*/React.createElement(\"h3\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 107,\n      columnNumber: 25\n    }\n  }, \"Rooms\"), /*#__PURE__*/React.createElement(\"br\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 108,\n      columnNumber: 25\n    }\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    id: \"rooms-list\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 109,\n      columnNumber: 25\n    }\n  }, /*#__PURE__*/React.createElement(Rooms, {\n    rooms: rooms,\n    handleEnterChat: handleEnterChat,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 110,\n      columnNumber: 29\n    }\n  }))), /*#__PURE__*/React.createElement(\"br\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 113,\n      columnNumber: 21\n    }\n  }))));\n};\n\nexport default RoomsPanel;","map":{"version":3,"sources":["/home/javiera/Documents/UNIVERSIDAD/2020-2/Arquitectura de Software/G16/iic2173-proyecto-semestral-grupo-16v2-frontend/src/components/RoomsPanel/RoomsPanel.jsx"],"names":["React","useState","useEffect","useHistory","url_add_room","url_rooms","url_auth","useAuth0","Rooms","RoomsPanel","history","rooms","setRooms","user","isAuthenticated","isLoading","logout","getAccessTokenSilently","loaded","setLoaded","checkUserUndefined","window","localStorage","getItem","undefined","removeItem","getUserMetadata","domain","accessToken","audience","scope","userDetailsByIdUrl","sub","metadataResponse","fetch","headers","Authorization","user_metadata","json","setItem","id","e","console","log","message","requestOptions","Accept","method","getRooms","then","response","data","result","err","handleExitPanel","push","handleEnterChat","event","preventDefault","target","value","sepData","split","chatId","chatName","location","reload","handleLogOutClick","returnTo"],"mappings":";AAAA,OAAOA,KAAP,IAAgBC,QAAhB,EAA0BC,SAA1B,QAA2C,OAA3C;AACA,SAASC,UAAT,QAA2B,kBAA3B;AACA,SAASC,YAAT,EAAuBC,SAAvB,EAAkCC,QAAlC,QAAkD,aAAlD;AACA,SAASC,QAAT,QAAyB,oBAAzB;AACA,OAAOC,KAAP,MAAkB,gBAAlB;AACA,OAAO,kBAAP;;AAEA,MAAMC,UAAU,GAAG,MAAM;AACrB,QAAMC,OAAO,GAAGP,UAAU,EAA1B;AACA,QAAM,CAACQ,KAAD,EAAQC,QAAR,IAAoBX,QAAQ,CAAC,EAAD,CAAlC;AACA,QAAM;AAAEY,IAAAA,IAAF;AAAQC,IAAAA,eAAR;AAAyBC,IAAAA,SAAzB;AAAoCC,IAAAA,MAApC;AAA4CC,IAAAA;AAA5C,MAAuEV,QAAQ,EAArF;AACA,QAAM,CAACW,MAAD,EAASC,SAAT,IAAsBlB,QAAQ,CAAC,KAAD,CAApC;;AAEA,QAAMmB,kBAAkB,GAAG,MAAM;AAC7B,QAAIC,MAAM,CAACC,YAAP,CAAoBC,OAApB,CAA4B,QAA5B,KAAyCC,SAA7C,EAAwD;AACpDH,MAAAA,MAAM,CAACC,YAAP,CAAoBG,UAApB,CAA+B,QAA/B;AACH;AACJ,GAJD;;AAMAvB,EAAAA,SAAS,CAAC,MAAM;AACZkB,IAAAA,kBAAkB;;AAClB,QAAIL,SAAJ,EAAc,CACb,CADD,MACO,IAAI,CAACG,MAAL,EAAa;AAChBC,MAAAA,SAAS,CAAC,IAAD,CAAT;;AAEA,YAAMO,eAAe,GAAG,YAAY;AAChC,cAAMC,MAAM,GAAG,2BAAf;;AACA,YAAI;AACA,gBAAMC,WAAW,GAAG,MAAMX,sBAAsB,CAAC;AAC7CY,YAAAA,QAAQ,EAAG,WAAUF,MAAO,UADiB;AAE7CG,YAAAA,KAAK,EAAE;AAFsC,WAAD,CAAhD;AAIA,gBAAMC,kBAAkB,GAAI,WAAUJ,MAAO,iBAAgBd,IAAI,CAACmB,GAAI,EAAtE;AAEA,gBAAMC,gBAAgB,GAAG,MAAMC,KAAK,CAACH,kBAAD,EAAqB;AACrDI,YAAAA,OAAO,EAAE;AACTC,cAAAA,aAAa,EAAG,UAASR,WAAY;AAD5B;AAD4C,WAArB,CAApC;AAMA,gBAAM;AAAES,YAAAA;AAAF,cAAoB,MAAMJ,gBAAgB,CAACK,IAAjB,EAAhC;AAEAjB,UAAAA,MAAM,CAACC,YAAP,CAAoBiB,OAApB,CAA4B,QAA5B,EAAsCF,aAAa,CAACG,EAApD;AACH,SAhBD,CAgBE,OAAOC,CAAP,EAAU;AACRC,UAAAA,OAAO,CAACC,GAAR,CAAY,QAAZ,EAAsBF,CAAC,CAACG,OAAxB;AACH;AACJ,OArBD;;AAsBA,UAAIC,cAAc,GAAG;AACjBC,QAAAA,MAAM,EAAE,kBADS;AAEjBC,QAAAA,MAAM,EAAE;AAFS,OAArB;;AAIA,YAAMC,QAAQ,GAAG,YAAY;AACzBd,QAAAA,KAAK,CAAC7B,SAAD,EAAYwC,cAAZ,CAAL,CACCI,IADD,CACO,MAAOC,QAAP,IAAoB;AACvB,cAAI;AACA,kBAAMC,IAAI,GAAG,MAAMD,QAAQ,CAACZ,IAAT,GAClBW,IADkB,CACbG,MAAM,IAAI;AACZxC,cAAAA,QAAQ,CAACwC,MAAD,CAAR;AACH,aAHkB,CAAnB;AAIH,WALD,CAKE,OAAOC,GAAP,EAAY;AACVX,YAAAA,OAAO,CAACC,GAAR,CAAYU,GAAZ;AACH;AACJ,SAVD;AAWH,OAZD;;AAaA3B,MAAAA,eAAe;AACfsB,MAAAA,QAAQ;AACX;AACJ,GAhDQ,CAAT;;AAkDA,QAAMM,eAAe,GAAG,MAAM;AAC1B5C,IAAAA,OAAO,CAAC6C,IAAR,CAAa,QAAb;AACH,GAFD;;AAIA,QAAMC,eAAe,GAAIC,KAAD,IAAW;AAC/BA,IAAAA,KAAK,CAACC,cAAN;AACA,UAAMP,IAAI,GAAGM,KAAK,CAACE,MAAN,CAAaC,KAA1B;AACA,QAAIC,OAAO,GAAGV,IAAI,CAACW,KAAL,CAAW,GAAX,CAAd;AACA,UAAMC,MAAM,GAAGF,OAAO,CAAC,CAAD,CAAtB;AACA,UAAMG,QAAQ,GAAGH,OAAO,CAAC,CAAD,CAAxB;AACAnD,IAAAA,OAAO,CAAC6C,IAAR,CAAc,oBAAmBS,QAAS,SAAQD,MAAO,EAAzD;AACA1C,IAAAA,MAAM,CAAC4C,QAAP,CAAgBC,MAAhB;AACH,GARD;;AAWA,QAAMC,iBAAiB,GAAG,MAAM;AAC5B9C,IAAAA,MAAM,CAACC,YAAP,CAAoBG,UAApB,CAA+B,QAA/B;AACAT,IAAAA,MAAM,CAAC;AAAEoD,MAAAA,QAAQ,EAAE9D;AAAZ,KAAD,CAAN;AACH,GAHD,CA7EqB,CAiFrB;;;AACA,SACIQ,eAAe,iBACf;AAAK,IAAA,GAAG,EAAEC,SAAV;AAAqB,IAAA,KAAK,EAAC,MAA3B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACI;AAAK,IAAA,KAAK,EAAC,SAAX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACA;AAAK,IAAA,SAAS,EAAE,KAAhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACI;AAAK,IAAA,SAAS,EAAE,MAAhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBAAK;AAAQ,IAAA,IAAI,EAAC,QAAb;AAAsB,IAAA,OAAO,EAAEuC,eAA/B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,2BAAL,CADJ,CADJ,eAII;AAAK,IAAA,SAAS,EAAE,OAAhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,uBAAK;AAAQ,IAAA,IAAI,EAAC,QAAb;AAAsB,IAAA,OAAO,EAAEa,iBAA/B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gBAAL,CADJ,CAJJ,CADA,eASI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IATJ,eAWI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAXJ,eAWa;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAXb,eAYI;AAAK,IAAA,KAAK,EAAC,WAAX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACI;AAAK,IAAA,KAAK,EAAC,KAAX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,aADJ,eAEI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAFJ,eAGI;AAAK,IAAA,EAAE,EAAC,YAAR;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACI,oBAAC,KAAD;AAAO,IAAA,KAAK,EAAExD,KAAd;AAAqB,IAAA,eAAe,EAAE6C,eAAtC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IADJ,CAHJ,CADJ,eAQI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IARJ,CAZJ,CADJ,CAFJ;AA6BH,CA/GD;;AAgHA,eAAe/C,UAAf","sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { useHistory } from 'react-router-dom';\nimport { url_add_room, url_rooms, url_auth } from \"./../Routes\"\nimport { useAuth0 } from \"@auth0/auth0-react\";\nimport Rooms from '../Rooms/Rooms';\nimport './RoomsPanel.css'\n\nconst RoomsPanel = () => {\n    const history = useHistory();\n    const [rooms, setRooms] = useState([]);\n    const { user, isAuthenticated, isLoading, logout, getAccessTokenSilently } = useAuth0();\n    const [loaded, setLoaded] = useState(false);\n\n    const checkUserUndefined = () => {\n        if (window.localStorage.getItem('userId') == undefined) {\n            window.localStorage.removeItem('userId');\n        }\n    }\n\n    useEffect(() => {\n        checkUserUndefined();\n        if (isLoading){\n        } else if (!loaded) {\n            setLoaded(true);\n\n            const getUserMetadata = async () => {\n                const domain = \"dev-3qxptrmu.us.auth0.com\";\n                try {\n                    const accessToken = await getAccessTokenSilently({\n                        audience: `https://${domain}/api/v2/`,\n                        scope: \"read:current_user\",\n                    });\n                    const userDetailsByIdUrl = `https://${domain}/api/v2/users/${user.sub}`;\n                \n                    const metadataResponse = await fetch(userDetailsByIdUrl, {\n                        headers: {\n                        Authorization: `Bearer ${accessToken}`,\n                        },\n                    });\n            \n                    const { user_metadata } = await metadataResponse.json();\n            \n                    window.localStorage.setItem('userId', user_metadata.id);\n                } catch (e) {\n                    console.log(\"ERROR:\", e.message);\n                }\n            };\n            var requestOptions = {\n                Accept: 'application/json',\n                method: 'GET'\n            };\n            const getRooms = async () => {\n                fetch(url_rooms, requestOptions) \n                .then( async (response) => {\n                    try {\n                        const data = await response.json()\n                        .then(result => {\n                            setRooms(result);\n                        })\n                    } catch (err) {\n                        console.log(err);\n                    }\n                })\n            }\n            getUserMetadata();\n            getRooms();\n        }\n    });\n\n    const handleExitPanel = () => {\n        history.push('/admin')\n    }\n\n    const handleEnterChat = (event) => {\n        event.preventDefault();\n        const data = event.target.value;\n        var sepData = data.split(\".\")\n        const chatId = sepData[0]\n        const chatName = sepData[1]\n        history.push(`/admin/chat?name=${chatName}&room=${chatId}`);\n        window.location.reload();\n    }\n\n\n    const handleLogOutClick = () => {\n        window.localStorage.removeItem('userId');\n        logout({ returnTo: url_auth })\n    }\n    // If is admin: \n    return (\n        isAuthenticated && (\n        <div key={isLoading} class=\"Full\">\n            <div class=\"Console\">\n            <div className={'Bar'}>\n                <div className={'Left'}>\n                    <div><button type=\"submit\" onClick={handleExitPanel}>Back to Admin Panel</button></div>\n                </div>\n                <div className={'Right'}>\n                    <h3> <button type=\"submit\" onClick={handleLogOutClick}> Log Out</button></h3>\n                </div>\n            </div>\n                <br></br>\n            \n                <br></br><br></br>\n                <div class=\"container\">\n                    <div class=\"box\">\n                        <h3>Rooms</h3>\n                        <br></br> \n                        <div id=\"rooms-list\">\n                            <Rooms rooms={rooms} handleEnterChat={handleEnterChat} />                \n                        </div>\n                    </div>\n                    <br></br>\n                </div>\n            </div>\n        </div>\n        )\n    )\n}\nexport default RoomsPanel;"]},"metadata":{},"sourceType":"module"}