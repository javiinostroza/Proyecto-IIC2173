{"ast":null,"code":"var _jsxFileName = \"/home/javiera/Documents/UNIVERSIDAD/2020-2/Arquitectura de Software/G16/iic2173-proyecto-semestral-grupo-16v2-frontend/src/components/Home/Logged.jsx\";\nimport React, { useState, useEffect } from 'react';\nimport { useHistory } from 'react-router-dom';\nimport { url_add_room, url_rooms, url_auth } from \"./../Routes\";\nimport Rooms from '../Rooms/Rooms';\nimport { useAuth0 } from \"@auth0/auth0-react\";\n\nconst HomeLogged = () => {\n  const history = useHistory();\n  const [newRoomName, setNewRoomName] = useState('');\n  const [rooms, setRooms] = useState([]);\n  const {\n    user,\n    isAuthenticated,\n    isLoading,\n    logout,\n    getAccessTokenSilently\n  } = useAuth0();\n  const [loaded, setLoaded] = useState(false);\n  const [isAdmin, setAdminStatus] = useState(false);\n\n  const checkUserUndefined = () => {\n    if (window.localStorage.getItem('userId') == undefined) {\n      window.localStorage.removeItem('userId');\n    }\n  };\n\n  useEffect(() => {\n    checkUserUndefined();\n\n    if (isLoading) {} else if (!loaded) {\n      setLoaded(true);\n      console.log(\"******USER: ***\", user);\n\n      const getUserMetadata = async () => {\n        const domain = \"dev-3qxptrmu.us.auth0.com\";\n\n        try {\n          const accessToken = await getAccessTokenSilently({\n            audience: `https://${domain}/api/v2/`,\n            scope: \"read:current_user\"\n          });\n          const userDetailsByIdUrl = `https://${domain}/api/v2/users/${user.sub}`;\n          const metadataResponse = await fetch(userDetailsByIdUrl, {\n            headers: {\n              Authorization: `Bearer ${accessToken}`\n            }\n          });\n          const {\n            user_metadata\n          } = await metadataResponse.json();\n\n          if (user_metadata.is_admin === \"true\") {\n            setAdminStatus(true);\n          }\n\n          window.localStorage.setItem('userId', user_metadata.id);\n          window.localStorage.setItem('isAdmin', user_metadata.is_admin);\n        } catch (e) {\n          console.log(\"ERROR:\", e.message);\n        }\n      };\n\n      var requestOptions = {\n        Accept: 'application/json',\n        method: 'GET'\n      };\n\n      const getRooms = async () => {\n        fetch(url_rooms, requestOptions).then(async response => {\n          try {\n            const data = await response.json().then(result => {\n              setRooms(result);\n            });\n          } catch (err) {\n            console.log(err);\n          }\n        });\n      };\n\n      getUserMetadata();\n      getRooms();\n    }\n  });\n\n  const handleAdminPanel = () => {\n    history.push('/admin');\n  };\n\n  const handleEnterChat = event => {\n    event.preventDefault();\n    const data = event.target.value;\n    var sepData = data.split(\".\");\n    const chatId = sepData[0];\n    const chatName = sepData[1];\n    history.push(`/chat?name=${chatName}&room=${chatId}`);\n    window.location.reload();\n  };\n\n  const handleSubmitNewRoom = event => {\n    var NewRoomHeader = new Headers();\n    const requestOptionsAddRoom = {\n      method: 'POST',\n      headers: NewRoomHeader,\n      redirect: 'follow'\n    };\n    event.preventDefault();\n    const url_ = url_add_room + newRoomName;\n    fetch(url_, requestOptionsAddRoom).then(response => response.text()).catch(error => console.log('error', error));\n    window.location.reload();\n  };\n\n  const handleLogOutClick = () => {\n    window.localStorage.removeItem('userId');\n    logout({\n      returnTo: url_auth\n    });\n  };\n\n  if (isAdmin) {\n    return isAuthenticated && /*#__PURE__*/React.createElement(\"div\", {\n      key: isLoading,\n      class: \"Full\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 112,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      class: \"Console\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 113,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: 'Bar',\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 114,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: 'Left',\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 115,\n        columnNumber: 21\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 116,\n        columnNumber: 25\n      }\n    }, /*#__PURE__*/React.createElement(\"button\", {\n      type: \"submit\",\n      onClick: handleAdminPanel,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 116,\n        columnNumber: 30\n      }\n    }, \"Go to Admin Panel\"))), /*#__PURE__*/React.createElement(\"div\", {\n      className: 'Right',\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 118,\n        columnNumber: 21\n      }\n    }, /*#__PURE__*/React.createElement(\"h3\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 119,\n        columnNumber: 25\n      }\n    }, \" \", /*#__PURE__*/React.createElement(\"button\", {\n      type: \"submit\",\n      onClick: handleLogOutClick,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 119,\n        columnNumber: 30\n      }\n    }, \" Log Out\")))), /*#__PURE__*/React.createElement(\"br\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 122,\n        columnNumber: 21\n      }\n    }), /*#__PURE__*/React.createElement(\"form\", {\n      class: \"mini-form\",\n      onSubmit: handleSubmitNewRoom,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 123,\n        columnNumber: 21\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 124,\n        columnNumber: 25\n      }\n    }, /*#__PURE__*/React.createElement(\"input\", {\n      type: \"text\",\n      onChange: event => setNewRoomName(event.target.value),\n      placeholder: \"room name\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 125,\n        columnNumber: 29\n      }\n    })), /*#__PURE__*/React.createElement(\"br\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 127,\n        columnNumber: 25\n      }\n    }), /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 128,\n        columnNumber: 25\n      }\n    }, /*#__PURE__*/React.createElement(\"input\", {\n      type: \"submit\",\n      value: \"Create Room\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 128,\n        columnNumber: 30\n      }\n    }))), /*#__PURE__*/React.createElement(\"br\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 131,\n        columnNumber: 21\n      }\n    }), /*#__PURE__*/React.createElement(\"br\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 131,\n        columnNumber: 30\n      }\n    }), /*#__PURE__*/React.createElement(\"h3\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 132,\n        columnNumber: 21\n      }\n    }, \"Rooms\"), /*#__PURE__*/React.createElement(\"br\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 133,\n        columnNumber: 21\n      }\n    }), /*#__PURE__*/React.createElement(\"div\", {\n      id: \"rooms-list\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 134,\n        columnNumber: 21\n      }\n    }, /*#__PURE__*/React.createElement(Rooms, {\n      rooms: rooms,\n      handleEnterChat: handleEnterChat,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 135,\n        columnNumber: 25\n      }\n    }))));\n  } else {\n    return isAuthenticated && /*#__PURE__*/React.createElement(\"div\", {\n      key: isLoading,\n      class: \"Full\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 144,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      class: \"Console\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 145,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: 'Bar',\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 146,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: 'Left',\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 147,\n        columnNumber: 21\n      }\n    }, /*#__PURE__*/React.createElement(\"h3\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 148,\n        columnNumber: 13\n      }\n    }, \"Status: Online \")), /*#__PURE__*/React.createElement(\"div\", {\n      className: 'Right',\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 150,\n        columnNumber: 21\n      }\n    }, /*#__PURE__*/React.createElement(\"h3\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 151,\n        columnNumber: 25\n      }\n    }, \" \", /*#__PURE__*/React.createElement(\"button\", {\n      type: \"submit\",\n      onClick: handleLogOutClick,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 151,\n        columnNumber: 30\n      }\n    }, \" Log Out\")))), /*#__PURE__*/React.createElement(\"br\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 154,\n        columnNumber: 21\n      }\n    }), /*#__PURE__*/React.createElement(\"form\", {\n      class: \"mini-form\",\n      onSubmit: handleSubmitNewRoom,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 155,\n        columnNumber: 21\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 156,\n        columnNumber: 25\n      }\n    }, /*#__PURE__*/React.createElement(\"input\", {\n      type: \"text\",\n      onChange: event => setNewRoomName(event.target.value),\n      placeholder: \"room name\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 157,\n        columnNumber: 29\n      }\n    })), /*#__PURE__*/React.createElement(\"br\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 159,\n        columnNumber: 25\n      }\n    }), /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 160,\n        columnNumber: 25\n      }\n    }, /*#__PURE__*/React.createElement(\"input\", {\n      type: \"submit\",\n      value: \"Create Room\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 160,\n        columnNumber: 30\n      }\n    }))), /*#__PURE__*/React.createElement(\"br\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 163,\n        columnNumber: 21\n      }\n    }), /*#__PURE__*/React.createElement(\"br\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 163,\n        columnNumber: 30\n      }\n    }), /*#__PURE__*/React.createElement(\"h3\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 164,\n        columnNumber: 21\n      }\n    }, \"Rooms\"), /*#__PURE__*/React.createElement(\"br\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 165,\n        columnNumber: 21\n      }\n    }), /*#__PURE__*/React.createElement(\"div\", {\n      id: \"rooms-list\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 166,\n        columnNumber: 21\n      }\n    }, /*#__PURE__*/React.createElement(Rooms, {\n      rooms: rooms,\n      handleEnterChat: handleEnterChat,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 167,\n        columnNumber: 25\n      }\n    }))));\n  }\n};\n\nexport default HomeLogged;","map":{"version":3,"sources":["/home/javiera/Documents/UNIVERSIDAD/2020-2/Arquitectura de Software/G16/iic2173-proyecto-semestral-grupo-16v2-frontend/src/components/Home/Logged.jsx"],"names":["React","useState","useEffect","useHistory","url_add_room","url_rooms","url_auth","Rooms","useAuth0","HomeLogged","history","newRoomName","setNewRoomName","rooms","setRooms","user","isAuthenticated","isLoading","logout","getAccessTokenSilently","loaded","setLoaded","isAdmin","setAdminStatus","checkUserUndefined","window","localStorage","getItem","undefined","removeItem","console","log","getUserMetadata","domain","accessToken","audience","scope","userDetailsByIdUrl","sub","metadataResponse","fetch","headers","Authorization","user_metadata","json","is_admin","setItem","id","e","message","requestOptions","Accept","method","getRooms","then","response","data","result","err","handleAdminPanel","push","handleEnterChat","event","preventDefault","target","value","sepData","split","chatId","chatName","location","reload","handleSubmitNewRoom","NewRoomHeader","Headers","requestOptionsAddRoom","redirect","url_","text","catch","error","handleLogOutClick","returnTo"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { useHistory } from 'react-router-dom';\nimport { url_add_room, url_rooms, url_auth } from \"./../Routes\"\nimport Rooms from '../Rooms/Rooms';\nimport { useAuth0 } from \"@auth0/auth0-react\";\n\nconst HomeLogged = () => {\n    const history = useHistory();\n    const [newRoomName, setNewRoomName] = useState('');\n    const [rooms, setRooms] = useState([]);\n    const { user, isAuthenticated, isLoading, logout, getAccessTokenSilently } = useAuth0();\n    const [loaded, setLoaded] = useState(false);\n    const [isAdmin, setAdminStatus] = useState(false);\n\n    const checkUserUndefined = () => {\n        if (window.localStorage.getItem('userId') == undefined) {\n            window.localStorage.removeItem('userId');\n        }\n    }\n\n    useEffect(() => {\n        checkUserUndefined();\n        if (isLoading){\n        } else if (!loaded) {\n            setLoaded(true);\n            console.log(\"******USER: ***\", user)\n            const getUserMetadata = async () => {\n                const domain = \"dev-3qxptrmu.us.auth0.com\";\n                try {\n                    const accessToken = await getAccessTokenSilently({\n                        audience: `https://${domain}/api/v2/`,\n                        scope: \"read:current_user\",\n                    });\n                    const userDetailsByIdUrl = `https://${domain}/api/v2/users/${user.sub}`;\n                \n                    const metadataResponse = await fetch(userDetailsByIdUrl, {\n                        headers: {\n                        Authorization: `Bearer ${accessToken}`,\n                        },\n                    });\n            \n                    const { user_metadata } = await metadataResponse.json();\n                    if (user_metadata.is_admin === \"true\"){\n                        setAdminStatus(true);\n                    }\n                    \n                    window.localStorage.setItem('userId', user_metadata.id);\n                    window.localStorage.setItem('isAdmin', user_metadata.is_admin);\n                } catch (e) {\n                    console.log(\"ERROR:\", e.message);\n                }\n            };\n            var requestOptions = {\n                Accept: 'application/json',\n                method: 'GET'\n            };\n            const getRooms = async () => {\n                fetch(url_rooms, requestOptions) \n                .then( async (response) => {\n                    try {\n                        const data = await response.json()\n                        .then(result => {\n                            setRooms(result);\n                        })\n                    } catch (err) {\n                        console.log(err);\n                    }\n                })\n            }\n            getUserMetadata();\n            getRooms();\n        }\n    });\n\n    const handleAdminPanel = () => {\n        history.push('/admin')\n    }\n\n    const handleEnterChat = (event) => {\n        event.preventDefault();\n        const data = event.target.value;\n        var sepData = data.split(\".\")\n        const chatId = sepData[0]\n        const chatName = sepData[1]\n        history.push(`/chat?name=${chatName}&room=${chatId}`);\n        window.location.reload();\n    }\n\n    const handleSubmitNewRoom = (event) => { \n        var NewRoomHeader = new Headers();\n        const requestOptionsAddRoom = {\n            method: 'POST',\n            headers: NewRoomHeader,\n            redirect: 'follow'\n        };\n        event.preventDefault();\n        const url_ = url_add_room + newRoomName\n        fetch(url_, requestOptionsAddRoom)\n            .then(response => response.text())\n            .catch(error => console.log('error', error));\n        window.location.reload();\n    }\n\n    const handleLogOutClick = () => {\n        window.localStorage.removeItem('userId');\n        logout({ returnTo: url_auth })\n    }\n\n    if(isAdmin){\n        return (\n            isAuthenticated && (\n            <div key={isLoading} class=\"Full\">\n                <div class=\"Console\">\n                <div className={'Bar'}>\n                    <div className={'Left'}>\n                        <div><button type=\"submit\" onClick={handleAdminPanel}>Go to Admin Panel</button></div>\n                    </div>\n                    <div className={'Right'}>\n                        <h3> <button type=\"submit\" onClick={handleLogOutClick}> Log Out</button></h3>\n                    </div>\n                </div>\n                    <br></br>\n                    <form class=\"mini-form\" onSubmit={handleSubmitNewRoom}>\n                        <div>\n                            <input type=\"text\" onChange={(event) => setNewRoomName(event.target.value)} placeholder=\"room name\"/>\n                        </div>\n                        <br></br>\n                        <div><input type=\"submit\" value=\"Create Room\"></input></div>\n                        \n                    </form>\n                    <br></br><br></br>\n                    <h3>Rooms</h3>\n                    <br></br> \n                    <div id=\"rooms-list\">\n                        <Rooms rooms={rooms} handleEnterChat={handleEnterChat} />                \n                    </div>\n                </div>\n            </div>\n            )\n        )\n    }else{\n        return (\n            isAuthenticated && (\n            <div key={isLoading} class=\"Full\">\n                <div class=\"Console\">\n                <div className={'Bar'}>\n                    <div className={'Left'}>\n            <h3>Status: Online </h3>\n                    </div>\n                    <div className={'Right'}>\n                        <h3> <button type=\"submit\" onClick={handleLogOutClick}> Log Out</button></h3>\n                    </div>\n                </div>\n                    <br></br>\n                    <form class=\"mini-form\" onSubmit={handleSubmitNewRoom}>\n                        <div>\n                            <input type=\"text\" onChange={(event) => setNewRoomName(event.target.value)} placeholder=\"room name\"/>\n                        </div>\n                        <br></br>\n                        <div><input type=\"submit\" value=\"Create Room\"></input></div>\n                        \n                    </form>\n                    <br></br><br></br>\n                    <h3>Rooms</h3>\n                    <br></br> \n                    <div id=\"rooms-list\">\n                        <Rooms rooms={rooms} handleEnterChat={handleEnterChat} />                \n                    </div>\n                </div>\n            </div>\n            )\n        )\n    } \n\n\n    \n    \n\n    \n    \n}\n\nexport default HomeLogged;"]},"metadata":{},"sourceType":"module"}