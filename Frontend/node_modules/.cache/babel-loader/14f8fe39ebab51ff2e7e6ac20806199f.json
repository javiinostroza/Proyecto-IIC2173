{"ast":null,"code":"var _jsxFileName = \"/home/javiera/Documents/UNIVERSIDAD/2020-2/Arquitectura de Software/G16/iic2173-proyecto-semestral-grupo-16v2-frontend/src/components/AdminChat/AdminChat.jsx\";\nimport React, { useState, useEffect } from \"react\";\nimport queryString from 'query-string';\nimport { url_display_chat, url_send_message, url_delete_all_messages, url_delete_room, url_delete_a_message, url_edit_a_message, url_get_old_message } from \"./../Routes\";\nimport { useHistory } from 'react-router-dom';\nimport '../Chat/Chat.css';\nimport '../general.css';\nimport './AdminChat.css';\nimport Input from '../Input/Input';\nimport AdminMessagesView from '../AdminMessagesView/AdminMessagesView';\nlet socket;\n\nconst AdminChat = ({\n  location\n}) => {\n  const history = useHistory();\n  const [name, setName] = useState('');\n  const [room, setRoom] = useState('');\n  const [messages, setMessages] = useState([]);\n  const [message, setMessage] = useState('');\n  const [selectedMessage, setSelectedMessage] = useState('');\n  const [originalMessage, setOriginalMessage] = useState('');\n  const ENDPOINT = 'ec2-18-219-25-136.us-east-2.compute.amazonaws.com:5000';\n  useEffect(() => {\n    const {\n      room,\n      name\n    } = queryString.parse(location.search);\n    setName(name);\n    setRoom(room);\n    var requestOptions = {\n      method: 'GET',\n      redirect: 'follow'\n    };\n    const url_ = url_display_chat + room;\n    fetch(url_, requestOptions).then(response => {\n      return response.json().then(data => {\n        const list = data.messages;\n        list.sort((a, b) => {\n          if (a.created_at > b.created_at) {\n            return 1;\n          } else {\n            return -1;\n          }\n        });\n        setMessages(list);\n        return data;\n      }).catch(err => {\n        console.log(err);\n      });\n    });\n  }, [room]);\n\n  const sendMessage = event => {\n    event.preventDefault();\n    var myHeaders = new Headers();\n    myHeaders.append(\"Content-Type\", \"application/x-www-form-urlencoded\");\n    var urlencoded = new URLSearchParams();\n    urlencoded.append(\"user_id\", window.localStorage.getItem('userId'));\n    urlencoded.append(\"room_id\", room);\n    urlencoded.append(\"message\", message);\n    var requestOptions = {\n      method: 'POST',\n      headers: myHeaders,\n      body: urlencoded,\n      redirect: 'follow'\n    };\n    fetch(url_send_message, requestOptions).then(response => {\n      return response.json().then(data => {\n        return data;\n      }).catch(err => {\n        console.log(err);\n      });\n    });\n    window.location.reload();\n  };\n\n  const handleExitChat = () => {\n    history.push('/roomspanel');\n  };\n\n  const handleDeleteMessage = event => {\n    event.preventDefault();\n    let message_id = selectedMessage.split('|')[0];\n    console.log(\"id: \", message_id);\n    console.log(\"delete \", selectedMessage);\n    var requestOptions = {\n      method: 'DELETE',\n      redirect: 'follow'\n    };\n    let url_detete = url_delete_a_message + message_id;\n    fetch(url_detete, requestOptions).then(response => response.text()).then(result => console.log(result)).catch(error => console.log('error', error));\n    window.location.reload();\n  };\n\n  const handleEditMessage = () => {\n    let message_id = selectedMessage.split('|')[0];\n    let message_content = selectedMessage.split(':')[1];\n    console.log(\"mesage id: \", message_id);\n    console.log(\"mesage content: \", message_content);\n    var new_message = prompt(\"EDIT THE MESSAGE\", message_content);\n    var myHeaders = new Headers();\n    myHeaders.append(\"Content-Type\", \"application/json\");\n    var raw = JSON.stringify({\n      \"message\": new_message\n    });\n    var requestOptions = {\n      method: 'PATCH',\n      headers: myHeaders,\n      body: raw,\n      redirect: 'follow'\n    };\n    let url_edit = url_edit_a_message + message_id;\n    fetch(url_edit, requestOptions).then(response => response.text()).then(result => console.log(result)).catch(error => console.log('error', error));\n    window.location.reload();\n  };\n\n  const handleSelectMessage = event => {\n    console.log(event.target.value);\n    event.preventDefault();\n    setSelectedMessage(event.target.value);\n  };\n\n  const handleDoubleClickedMessage = event => {\n    let messageId = event.target.value.split('|')[0];\n    var requestOptions = {\n      method: 'GET',\n      redirect: 'follow'\n    };\n\n    let _url = url_get_old_message + messageId;\n\n    fetch(_url, requestOptions).then(response => response.json()).then(result => console.log(setOriginalMessage(result.oldmessage))).catch(error => console.log('error', error));\n  };\n\n  const handleDeleteRoom = event => {\n    event.preventDefault();\n    var formdata = new FormData();\n    var requestOptionsAllMessages = {\n      method: 'DELETE',\n      body: formdata,\n      redirect: 'follow'\n    };\n    let msgs_url = url_delete_all_messages + room;\n    fetch(msgs_url, requestOptionsAllMessages).then(response => response.text()).then(result => console.log(result)).catch(error => console.log('error', error));\n    var requestOptionsRoom = {\n      method: 'DELETE',\n      redirect: 'follow'\n    };\n    let room_url = url_delete_room + room;\n    fetch(room_url, requestOptionsRoom).then(response => response.text()).then(result => console.log(result)).catch(error => console.log('error', error));\n    history.push('/roomspanel');\n    window.location.reload();\n  };\n\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: \"Full\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 192,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"Console\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 193,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: 'ChatContainer',\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 194,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: 'Bar',\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 195,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: 'Left',\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 196,\n      columnNumber: 21\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 197,\n      columnNumber: 25\n    }\n  }, /*#__PURE__*/React.createElement(\"button\", {\n    type: \"submit\",\n    onClick: handleDeleteRoom,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 197,\n      columnNumber: 30\n    }\n  }, \"Delete \", name))), /*#__PURE__*/React.createElement(\"div\", {\n    className: 'Right',\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 199,\n      columnNumber: 21\n    }\n  }, /*#__PURE__*/React.createElement(\"h3\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 200,\n      columnNumber: 25\n    }\n  }, \" \", /*#__PURE__*/React.createElement(\"button\", {\n    type: \"submit\",\n    onClick: handleExitChat,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 200,\n      columnNumber: 30\n    }\n  }, \" Exit Room\")))), /*#__PURE__*/React.createElement(\"div\", {\n    id: \"message-list\",\n    onDoubleClick: handleDoubleClickedMessage,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 203,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(AdminMessagesView, {\n    messages: messages,\n    handleSelectMessage: handleSelectMessage,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 204,\n      columnNumber: 21\n    }\n  })), /*#__PURE__*/React.createElement(\"div\", {\n    className: 'Bar',\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 206,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: 'DownLeft',\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 207,\n      columnNumber: 21\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 208,\n      columnNumber: 25\n    }\n  }, /*#__PURE__*/React.createElement(\"button\", {\n    type: \"submit\",\n    onClick: handleDeleteMessage,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 208,\n      columnNumber: 30\n    }\n  }, \" Delete Message \"))), /*#__PURE__*/React.createElement(\"div\", {\n    className: 'DownRight',\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 210,\n      columnNumber: 21\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 211,\n      columnNumber: 25\n    }\n  }, /*#__PURE__*/React.createElement(\"button\", {\n    type: \"submit\",\n    onClick: handleEditMessage,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 211,\n      columnNumber: 30\n    }\n  }, \" Edit Message \")))), /*#__PURE__*/React.createElement(\"br\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 214,\n      columnNumber: 17\n    }\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    id: \"old_message\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 215,\n      columnNumber: 17\n    }\n  }, \"Original message: \", originalMessage))));\n};\n\nexport default AdminChat;","map":{"version":3,"sources":["/home/javiera/Documents/UNIVERSIDAD/2020-2/Arquitectura de Software/G16/iic2173-proyecto-semestral-grupo-16v2-frontend/src/components/AdminChat/AdminChat.jsx"],"names":["React","useState","useEffect","queryString","url_display_chat","url_send_message","url_delete_all_messages","url_delete_room","url_delete_a_message","url_edit_a_message","url_get_old_message","useHistory","Input","AdminMessagesView","socket","AdminChat","location","history","name","setName","room","setRoom","messages","setMessages","message","setMessage","selectedMessage","setSelectedMessage","originalMessage","setOriginalMessage","ENDPOINT","parse","search","requestOptions","method","redirect","url_","fetch","then","response","json","data","list","sort","a","b","created_at","catch","err","console","log","sendMessage","event","preventDefault","myHeaders","Headers","append","urlencoded","URLSearchParams","window","localStorage","getItem","headers","body","reload","handleExitChat","push","handleDeleteMessage","message_id","split","url_detete","text","result","error","handleEditMessage","message_content","new_message","prompt","raw","JSON","stringify","url_edit","handleSelectMessage","target","value","handleDoubleClickedMessage","messageId","_url","oldmessage","handleDeleteRoom","formdata","FormData","requestOptionsAllMessages","msgs_url","requestOptionsRoom","room_url"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from \"react\";\nimport queryString from 'query-string';\nimport {\n    url_display_chat, \n    url_send_message, \n    url_delete_all_messages, \n    url_delete_room, \n    url_delete_a_message,\n    url_edit_a_message,\n    url_get_old_message\n} from \"./../Routes\";\nimport { useHistory } from 'react-router-dom';\n\n\nimport '../Chat/Chat.css'\nimport '../general.css'\nimport './AdminChat.css'\n\nimport Input from '../Input/Input';\nimport AdminMessagesView from '../AdminMessagesView/AdminMessagesView';\nlet socket;\n\n\n\nconst AdminChat = ({ location }) => {\n    const history = useHistory();\n    const [name, setName] = useState('');\n    const [room, setRoom] = useState('');\n    const [messages, setMessages] = useState([]);\n    const [message, setMessage] = useState('');\n    const [selectedMessage, setSelectedMessage] = useState('');\n    const [originalMessage, setOriginalMessage] = useState('');\n    const ENDPOINT = 'ec2-18-219-25-136.us-east-2.compute.amazonaws.com:5000'\n    \n\n    useEffect(() => {\n        const {room, name} = queryString.parse(location.search);\n        setName(name);\n        setRoom(room);\n\n        var requestOptions = {\n            method: 'GET',\n            redirect: 'follow'\n        };\n        const url_ = url_display_chat + room;\n        fetch(url_, requestOptions)\n            .then((response) => {\n                return response.json().then((data) => {\n                    const list = data.messages\n                    list.sort((a,b) => {\n                        if(a.created_at > b.created_at){\n                            return 1\n                        }else{\n                            return -1\n                        }\n                    })\n                    setMessages(list);\n                    return data;\n                }).catch((err) => {\n                    console.log(err);\n                })\n            })\n\n    }, [room]);\n\n    \n\n    const sendMessage = (event) => {\n        event.preventDefault();\n        var myHeaders = new Headers();\n        myHeaders.append(\"Content-Type\", \"application/x-www-form-urlencoded\");\n\n        var urlencoded = new URLSearchParams();\n        urlencoded.append(\"user_id\", window.localStorage.getItem('userId'));\n        urlencoded.append(\"room_id\", room);\n        urlencoded.append(\"message\", message);\n        var requestOptions = {\n        method: 'POST',\n        headers: myHeaders,\n        body: urlencoded,\n        redirect: 'follow'\n        };\n        fetch(url_send_message, requestOptions)\n        .then((response) => {\n            return response.json().then((data) => {\n                return data;\n            }).catch((err) => {\n                console.log(err);\n            });\n        })\n        window.location.reload()        \n    }\n\n    const handleExitChat = () => {\n        history.push('/roomspanel')\n    }\n\n    const handleDeleteMessage = (event) => {\n        event.preventDefault();\n        let message_id = selectedMessage.split('|')[0];\n        console.log(\"id: \", message_id)\n        console.log(\"delete \", selectedMessage)\n\n        var requestOptions = {\n            method: 'DELETE',\n            redirect: 'follow'\n        };\n        let url_detete = url_delete_a_message + message_id\n        fetch(url_detete, requestOptions)\n            .then(response => response.text())\n            .then(result => console.log(result))\n            .catch(error => console.log('error', error));\n        window.location.reload()\n\n\n    }\n\n    const handleEditMessage = () => {\n        let message_id = selectedMessage.split('|')[0];\n        let message_content = selectedMessage.split(':')[1];\n        console.log(\"mesage id: \", message_id);\n        console.log(\"mesage content: \", message_content);\n        var new_message = prompt(\"EDIT THE MESSAGE\", message_content);\n\n        var myHeaders = new Headers();\n        myHeaders.append(\"Content-Type\", \"application/json\");\n\n        var raw = JSON.stringify({\"message\":new_message});\n\n        var requestOptions = {\n        method: 'PATCH',\n        headers: myHeaders,\n        body: raw,\n        redirect: 'follow'\n        };\n        let url_edit = url_edit_a_message + message_id;\n        fetch(url_edit, requestOptions)\n        .then(response => response.text())\n        .then(result => console.log(result))\n        .catch(error => console.log('error', error));\n        window.location.reload()\n    }\n\n    const handleSelectMessage = (event) => {\n        console.log(event.target.value)\n        event.preventDefault();\n        setSelectedMessage(event.target.value)\n    }\n\n    const handleDoubleClickedMessage = (event) =>{\n        let messageId = event.target.value.split('|')[0];\n\n        var requestOptions = {\n            method: 'GET',\n            redirect: 'follow'\n    };\n        let _url = url_get_old_message + messageId\n        fetch(_url, requestOptions)\n            .then(response => response.json())\n            .then(result => console.log(setOriginalMessage(result.oldmessage)))\n            .catch(error => console.log('error', error));\n        \n    }\n\n    const handleDeleteRoom = (event) => {\n        event.preventDefault();\n        var formdata = new FormData();\n        var requestOptionsAllMessages = {\n        method: 'DELETE',\n        body: formdata,\n        redirect: 'follow'\n        };\n        let msgs_url = url_delete_all_messages + room;\n        fetch(msgs_url, requestOptionsAllMessages)\n        .then(response => response.text())\n        .then(result => console.log(result))\n        .catch(error => console.log('error', error));\n        var requestOptionsRoom = {\n            method: 'DELETE',\n            redirect: 'follow'\n          };\n        let room_url = url_delete_room + room;\n        fetch(room_url, requestOptionsRoom)\n            .then(response => response.text())\n            .then(result => console.log(result))\n            .catch(error => console.log('error', error));\n        history.push('/roomspanel')\n        window.location.reload()\n    }\n\n    return (\n        <div className='Full'>\n        <div className='Console'>\n            <div className={'ChatContainer'}>\n                <div className={'Bar'}>\n                    <div className={'Left'}>\n                        <div><button type=\"submit\" onClick={handleDeleteRoom}>Delete {name}</button></div>\n                    </div>\n                    <div className={'Right'}>\n                        <h3> <button type=\"submit\" onClick={handleExitChat}> Exit Room</button></h3>\n                    </div>\n                </div>\n                <div id=\"message-list\" onDoubleClick={handleDoubleClickedMessage}>\n                    <AdminMessagesView messages={messages} handleSelectMessage={handleSelectMessage} />\n                </div>\n                <div className={'Bar'}>\n                    <div className={'DownLeft'}>\n                        <div><button type=\"submit\" onClick={handleDeleteMessage}> Delete Message </button></div>\n                    </div>\n                    <div className={'DownRight'}>\n                        <div><button type=\"submit\" onClick={handleEditMessage}> Edit Message </button></div>\n                    </div>\n                </div>\n                <br></br>\n                <div id=\"old_message\">Original message: {originalMessage}</div>\n            </div>\n        </div>\n    </div>\n    )\n}\n\nexport default AdminChat;\n"]},"metadata":{},"sourceType":"module"}